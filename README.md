# Система задач для Screeps

Это система управления задачами для игры Screeps, реализующая приоритетное распределение задач между крипами разных ролей.

## Архитектура системы

### Основные модули

1. **taskManager.js** - Ядро системы задач
   - Управление глобальным списком задач в Game.tasks
   - Приоритеты: HIGH, MEDIUM, LOW
   - Роли: Miner, Taxi, Courier, Builder, Repairer, Upgrader, Spawner
   - Поддержка групповых и одиночных задач
   - Бесконечные и персональные задачи

2. **creepPrototype.js** - Общий прототип для крипов
   - Базовые функции для всех ролей
   - Методы для работы с задачами
   - Система назначения и выполнения задач

3. **creep.prototype.{rolename}.js** - Прототипы для каждой роли
   - **creep.prototype.miner.js** - Майнеры (копают под себя, без ног)
   - **creep.prototype.taxi.js** - Такси (доставка майнеров)
   - **creep.prototype.courier.js** - Курьеры (транспортировка ресурсов)
   - **creep.prototype.builder.js** - Строители (строительство)
   - **creep.prototype.repairer.js** - Ремонтники (ремонт структур)
   - **creep.prototype.upgrader.js** - Апгрейдеры (апгрейд контроллера)

4. **roomScanner.js** - Сканирование комнат
   - Автоматическое создание задач на основе состояния комнаты
   - Проверка актуальности задач (раз в 15 тиков)
   - Создание задач для источников, строительства, ремонта и т.д.

5. **spawnerManager.js** - Управление спавнерами
   - Спавн крипов на основе потребностей
   - Оптимизация тел крипов под роли
   - Балансировка между ролями

6. **main.js** - Основной цикл
   - Координация всех модулей
   - 15-тиковые циклы проверки
   - Логирование состояния системы

## Особенности системы

### Ролевая система
- **Miner** - Майнеры без ног, копают под себя, привязаны к источнику
- **Taxi** - Доставка майнеров на место работы
- **Courier** - Транспортировка ресурсов из куч
- **Builder** - Строительство конструкций
- **Repairer** - Ремонт структур
- **Upgrader** - Апгрейд контроллера
- **Spawner** - Спавн крипов

### Особенности игры
- 1 источник = 1 майнер (фиксированное соответствие)
- Майнеры привязаны к источнику и не могут менять место
- Все остальные крипы берут ресурсы из куч (не из контейнеров)
- Майнеры не имеют ног, требуют доставки Taxi
- Спавнеры создают крипов с оптимальным телом для каждой роли

### Приоритеты задач
- **HIGH** - Критические задачи (доставка майнеров, защита)
- **MEDIUM** - Важные задачи (строительство, апгрейд, ремонт)
- **LOW** - Рутинные задачи (обычный ремонт, сбор)

### Типы задач
- **Одиночные задачи** - Для одного крипа (например, доставка майнера)
- **Групповые задачи** - Для нескольких крипов (например, строительство)
- **Бесконечные задачи** - Регенерирующиеся (добыча, апгрейд)
- **Персональные задачи** - Для конкретного крипа

### Хранение данных
- **Game.tasks** - Информация о задачах (глобальное)
- **creep.memory.taskId** - Выполняемая задача (локально у крипа)
- **Задача висит в памяти** пока не будет выполнена

### Циклы работы
- **15 тиков** - Сканирование комнат и создание задач
- **Каждый тик** - Назначение задач и управление крипами
- **Каждый тик** - Проверка необходимости спавна крипов
- **100 тиков** - Логирование состояния системы

## Примеры задач

### Бесконечные задачи
```javascript
{
  id: "task_abc123",
  type: "MINE_SOURCE",
  target: "source_id",
  roles: ["Miner"],
  infinite: true,
  priority: "HIGH",
  groupSize: 1,
  assignedCreeps: []
}
```

### Групповые задачи
```javascript
{
  id: "task_def456",
  type: "BUILD",
  target: "construction_site_id",
  roles: ["Builder", "Repairer"],
  priority: "MEDIUM",
  groupSize: 3,
  assignedCreeps: []
}
```

### Персональные задачи
```javascript
{
  id: "task_ghi789",
  type: "DELIVER_MINER",
  target: "source_id",
  roles: ["Taxi"],
  priority: "HIGH",
  groupSize: 1,
  assignedCreeps: []
}
```

## Использование

### Запуск системы
Система автоматически запускается через main.js. Достаточно загрузить файлы в игру.

### Добавление новых ролей
1. Добавить роль в taskManager.ROLE
2. Создать файл creep.prototype.{rolename}.js с логикой выполнения
3. Обновить spawnerManager для спавна новой роли
4. Добавить require() в main.js
5. Добавить вызов в manageCreeps() функции

### Добавление новых типов задач
1. Добавить тип в taskManager.TASK_TYPE
2. Реализовать логику создания в roomScanner
3. Реализовать логику выполнения в соответствующей роли

### Добавление новых методов в прототип
1. Добавить метод в creepPrototype.js
2. Переопределить в нужных ролях при необходимости

## Логика работы

### 1. Создание задач
- Каждые 15 тиков сканируются все комнаты
- Автоматически создаются задачи на основе состояния комнаты
- Задачи распределяются по приоритетам и ролям

### 2. Назначение крипов
- Крипы ищут свободные задачи подходящей роли
- Выбирается задача с наивысшим приоритетом
- Крип привязывается к задаче и начинает выполнение

### 3. Спавн крипов
- Спавнеры анализируют потребность в крипах
- Создаются крипы с оптимальным телом для роли
- Приоритет: Miner → Taxi → Courier → Builder → Repairer → Upgrader

### 4. Выполнение задач
- Каждая роль имеет свою логику выполнения в прототипе
- Майнеры привязываются к источникам
- Такси доставляют майнеров на место
- Остальные крипы работают с кучами ресурсов
- Групповые задачи выполняются несколькими крипами
- Спавнеры создают крипов с оптимальным телом для каждой роли

## Требования

- Игра Screeps
- Доступ к Game API
- Минимум одна комната с контроллером
- Спавнер для создания крипов

## Лицензия

Этот код предоставляется как есть для использования в игре Screeps.